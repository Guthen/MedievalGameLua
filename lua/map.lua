Map = 
{
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 5, 0, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 1, 1, 1, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 2, 0, 0, 0, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 1, 1, 1, 5, 0, 0, 0, 0, 0, 4, 1, 2, 0, 0, 0, 0, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0},
  {1, 1, 1, 1, 5, 0, 0, 0, 0, 0, 0, 0, 4, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0},
  {0, 0, 0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 1, 1, 2, 0, 0, 0, 0, 6, 0, 0, 0, 0},
  {6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 5, 0, 0, 0, 0, 0, 4, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 6, 6},
  {6, 6, 6, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 0, 0},
  {0, 0, 0, 0, 0, 0, 6, 6, 6, 7, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 7, 6, 6, 0, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
}

function Map:MapSmooth() 
    if not mapSmooth then return end
    for y, yv in pairs(Map) do
        if type(yv) == "table" then
            for x, xv in pairs(yv) do

                -- CLIFF SMOOTH
                if xv == 1 then
                    if Map[y][x+1] == 0 and Map[y+1][x+1] == 0 then -- si à droite == 0 et en bas à droite == 0
                        Map[y][x] = 2 -- mettre coin droit
                    end
                    if Map[y][x-1] == 0 and Map[y+1][x-1] == 0 then -- si à gauche == 0 et en bas à gauche == 0
                        Map[y][x] = 3 -- mettre coin gauche
                    end
                    if Map[y][x+1] == 0 and Map[y+1][x+1] == 1 then 
                        Map[y][x+1] = 5
                    end
                    if Map[y][x-1] == 0 and Map[y+1][x-1] == 1 then
                        Map[y][x-1] = 4
                    end

                    if Map[y][x+1] == 2 or Map[y][x+1] == 3 and Map[y][x+2] == 1 then
                        Map[y][x+1] = 1
                    elseif Map[y][x-1] == 2 or Map[y][x-1] == 3 and Map[y][x-2] == 1 then
                        Map[y][x-1] = 1
                    end
                end

            end
        end
    end
end

function Map:Load()
    MapImg = 
    {
      [0] = Image["terrain_grass"],
      [1] = Image["terrain_cliff"],
      [2] = Image["terrain_cliff_right_end"],
      [3] = Image["terrain_cliff_left_end"],
      [4] = Image["terrain_cliff_right"],
      [5] = Image["terrain_cliff_left"],
      [6] = Image["terrain_water"],
      [7] = Image["terrain_water_bridge"],
    }
    BlockMapID = 
    {
        [0] = false,
        [1] = true,
        [2] = true,
        [3] = true,
        [4] = false,
        [5] = false,
        [6] = true,
        [7] = false,
    }
    self.MapEditImg = 1
    self.MapEdit = false

    -- AUTO SMOOTHING
    self:MapSmooth()
end

function Map:Key(k)
    if k == "m" then
        self.MapEdit = Toggle(self.MapEdit)
        if self.MapEdit == false then Map:MapSmooth() PrintTable(Map) end
    end
    if self.MapEdit then
        if k == "right" then
            self.MapEditImg = self.MapEditImg + 1
            if self.MapEditImg > #MapImg then self.MapEditImg = 1 end
        elseif k == "left" then
            self.MapEditImg = self.MapEditImg - 1
            if self.MapEditImg < 1 then self.MapEditImg = #MapImg end
        end
    end
end

function Map:Draw()
    for y, yv in pairs(self) do
        if type(yv) == "table" then
           for x, xv in pairs(yv) do
                love.graphics.draw(MapImg[xv], (x-1)*tilesetSize, (y-1)*tilesetSize, 0, tilesetSize/MapImg[xv]:getWidth(), tilesetSize/MapImg[xv]:getHeight())
            end
        end
    end
    if self.MapEdit then
        love.graphics.print("[M] Map Editor : ", 0, 0)
        love.graphics.print("Left Arrow : -1 | Right Arrow : +1", 0, 15)
        love.graphics.print("Current ID : "..Map.MapEditImg, 0, 30)
    end
end

